(function(e,t){var n=0;e.widget("ech.multiselect",{options:{header:!0,height:175,minWidth:225,classes:"",checkAllText:"Check all",uncheckAllText:"Uncheck all",noneSelectedText:"Select options",selectedText:"# selected",selectedList:0,show:"",hide:"",autoOpen:!1,multiple:!0,position:{}},_create:function(){var t=this.element.hide(),n=this.options;this.speed=e.fx.speeds._default,this._isOpen=!1;var r=(this.button=e('<button type="button"><span class="ui-icon ui-icon-triangle-2-n-s"></span></button>')).addClass("ui-multiselect ui-widget ui-state-default ui-corner-all").addClass(n.classes).attr({title:t.attr("title"),"aria-haspopup":!0,tabIndex:t.attr("tabIndex")}).insertAfter(t),i=(this.buttonlabel=e("<span />")).html(n.noneSelectedText).appendTo(r),s=(this.menu=e("<div />")).addClass("ui-multiselect-menu ui-widget ui-widget-content ui-corner-all").addClass(n.classes).appendTo(document.body),o=(this.header=e("<div />")).addClass("ui-widget-header ui-corner-all ui-multiselect-header ui-helper-clearfix").appendTo(s),u=(this.headerLinkContainer=e("<ul />")).addClass("ui-helper-reset").html(function(){return n.header===!0?'<li><a class="ui-multiselect-all" href="#"><span class="ui-icon ui-icon-check"></span><span>'+n.checkAllText+'</span></a></li><li><a class="ui-multiselect-none" href="#"><span class="ui-icon ui-icon-closethick"></span><span>'+n.uncheckAllText+"</span></a></li>":typeof n.header=="string"?"<li>"+n.header+"</li>":""}).append('<li class="ui-multiselect-close"><a href="#" class="ui-multiselect-close"><span class="ui-icon ui-icon-circle-close"></span></a></li>').appendTo(o),a=(this.checkboxContainer=e("<ul />")).addClass("ui-multiselect-checkboxes ui-helper-reset").appendTo(s);this._bindEvents(),this.refresh(!0),n.multiple||s.addClass("ui-multiselect-single")},_init:function(){this.options.header===!1&&this.header.hide(),this.options.multiple||this.headerLinkContainer.find(".ui-multiselect-all, .ui-multiselect-none").hide(),this.options.autoOpen&&this.open(),this.element.is(":disabled")&&this.disable()},refresh:function(r){var i=this.element,s=this.options,o=this.menu,u=this.checkboxContainer,a=[],f="",l=i.attr("id")||n++;i.find("option").each(function(n){var r=e(this),i=this.parentNode,o=this.innerHTML,u=this.title,c=this.value,h="ui-multiselect-"+(this.id||l+"-option-"+n),p=this.disabled,d=this.selected,v=["ui-corner-all"],m,g=e(this).data("color_index");g!==t&&g!==null&&v.push("ui-item-color-"+g),i.tagName==="OPTGROUP"&&(m=i.getAttribute("label"),e.inArray(m,a)===-1&&(f+='<li class="ui-multiselect-optgroup-label"><a href="#">'+m+"</a></li>",a.push(m))),p&&v.push("ui-state-disabled"),d&&!s.multiple&&v.push("ui-state-active"),f+='<li class="'+(p?"ui-multiselect-disabled":"")+'">',f+='<label for="'+h+'" title="'+u+'" class="'+v.join(" ")+'">',f+='<input id="'+h+'" name="multiselect_'+l+'" type="'+(s.multiple?"checkbox":"radio")+'" value="'+c+'" title="'+o+'"',d&&(f+=' checked="checked"',f+=' aria-selected="true"'),p&&(f+=' disabled="disabled"',f+=' aria-disabled="true"'),f+=" /><span>"+o+"</span></label></li>"}),u.html(f),this.labels=o.find("label"),this.inputs=this.labels.children("input"),this._setButtonWidth(),this._setMenuWidth(),this.button[0].defaultValue=this.update(),r||this._trigger("refresh")},update:function(){var t=this.options,n=this.inputs,r=n.filter(":checked"),i=r.length,s;return i===0?s=t.noneSelectedText:e.isFunction(t.selectedText)?s=t.selectedText.call(this,i,n.length,r.get()):/\d/.test(t.selectedList)&&t.selectedList>0&&i<=t.selectedList?s=r.map(function(){return e(this).next().html()}).get().join(", "):s=t.selectedText.replace("#",i).replace("#",n.length),this.buttonlabel.html(s),s},_bindEvents:function(){function r(){return t[t._isOpen?"close":"open"](),!1}var t=this,n=this.button;n.find("span").bind("click.multiselect",r),n.bind({click:r,keypress:function(e){switch(e.which){case 27:case 38:case 37:t.close();break;case 39:case 40:t.open()}},mouseenter:function(){n.hasClass("ui-state-disabled")||e(this).addClass("ui-state-hover")},mouseleave:function(){e(this).removeClass("ui-state-hover")},focus:function(){n.hasClass("ui-state-disabled")||e(this).addClass("ui-state-focus")},blur:function(){e(this).removeClass("ui-state-focus")}}),this.header.delegate("a","click.multiselect",function(n){e(this).hasClass("ui-multiselect-close")?t.close():t[e(this).hasClass("ui-multiselect-all")?"checkAll":"uncheckAll"](),n.preventDefault()}),this.menu.delegate("li.ui-multiselect-optgroup-label a","click.multiselect",function(n){n.preventDefault();var r=e(this),i=r.parent().nextUntil("li.ui-multiselect-optgroup-label").find("input:visible:not(:disabled)"),s=i.get(),o=r.parent().text();if(t._trigger("beforeoptgrouptoggle",n,{inputs:s,label:o})===!1)return;t._toggleChecked(i.filter(":checked").length!==i.length,i),t._trigger("optgrouptoggle",n,{inputs:s,label:o,checked:s[0].checked})}).delegate("label","mouseenter.multiselect",function(){if(!e(this).hasClass("ui-state-disabled")){t.labels.removeClass("ui-state-hover"),e(this).addClass("ui-state-hover").find("input").focus();for(var n=0;n<5;n++)t.labels.removeClass("ui-item-bg-color-"+n);for(n=0;n<5;n++)if(e(this).hasClass("ui-item-color-"+n)){e(this).addClass("ui-item-bg-color-"+n);break}}}).delegate("label","keydown.multiselect",function(n){n.preventDefault();switch(n.which){case 9:case 27:t.close();break;case 38:case 40:case 37:case 39:t._traverse(n.which,this);break;case 13:e(this).find("input")[0].click()}}).delegate('input[type="checkbox"], input[type="radio"]',"click.multiselect",function(n){var r=e(this),i=this.value,s=this.checked,o=t.element.find("option");if(this.disabled||t._trigger("click",n,{value:i,text:this.title,checked:s})===!1){n.preventDefault();return}r.focus(),r.attr("aria-selected",s),o.each(function(){this.value===i?this.selected=s:t.options.multiple||(this.selected=!1)}),t.options.multiple||(t.labels.removeClass("ui-state-active"),r.closest("label").toggleClass("ui-state-active",s),t.close()),t.element.trigger("change"),setTimeout(e.proxy(t.update,t),10)}),e(document).bind("mousedown.multiselect",function(n){t._isOpen&&!e.contains(t.menu[0],n.target)&&!e.contains(t.button[0],n.target)&&n.target!==t.button[0]&&t.close()}),e(this.element[0].form).bind("reset.multiselect",function(){setTimeout(e.proxy(t.refresh,t),10)})},_setButtonWidth:function(){var e=this.element.outerWidth(),t=this.options;/\d/.test(t.minWidth)&&e<t.minWidth&&(e=t.minWidth),this.button.width(e)},_setMenuWidth:function(){var e=this.menu,t=this.button.outerWidth()-parseInt(e.css("padding-left"),10)-parseInt(e.css("padding-right"),10)-parseInt(e.css("border-right-width"),10)-parseInt(e.css("border-left-width"),10);e.width(t||this.button.outerWidth())},_traverse:function(t,n){var r=e(n),i=t===38||t===37,s=r.parent()[i?"prevAll":"nextAll"]("li:not(.ui-multiselect-disabled, .ui-multiselect-optgroup-label)")[i?"last":"first"]();if(!s.length){var o=this.menu.find("ul").last();this.menu.find("label")[i?"last":"first"]().trigger("mouseover"),o.scrollTop(i?o.height():0)}else s.find("label").trigger("mouseover")},_toggleState:function(e,t){return function(){this.disabled||(this[e]=t),t?this.setAttribute("aria-selected",!0):this.removeAttribute("aria-selected")}},_toggleChecked:function(t,n){var r=n&&n.length?n:this.inputs,i=this;r.each(this._toggleState("checked",t)),r.eq(0).focus(),this.update();var s=r.map(function(){return this.value}).get();this.element.find("option").each(function(){!this.disabled&&e.inArray(this.value,s)>-1&&i._toggleState("selected",t).call(this)}),r.length&&this.element.trigger("change")},_toggleDisabled:function(t){this.button.attr({disabled:t,"aria-disabled":t})[t?"addClass":"removeClass"]("ui-state-disabled");var n=this.menu.find("input"),r="ech-multiselect-disabled";t?n=n.filter(":enabled").data(r,!0):n=n.filter(function(){return e.data(this,r)===!0}).removeData(r),n.attr({disabled:t,"arial-disabled":t}).parent()[t?"addClass":"removeClass"]("ui-state-disabled"),this.element.attr({disabled:t,"aria-disabled":t})},open:function(t){var n=this,r=this.button,i=this.menu,s=this.speed,o=this.options;if(this._trigger("beforeopen")===!1||r.hasClass("ui-state-disabled")||this._isOpen)return;var u=i.find("ul").last(),a=o.show,f=r.offset();e.isArray(o.show)&&(a=o.show[0],s=o.show[1]||n.speed),u.scrollTop(0).height(o.height),e.ui.position&&!e.isEmptyObject(o.position)?(o.position.of=o.position.of||r,i.show().position(o.position).hide().show(a,s)):i.css({top:f.top+r.outerHeight(),left:f.left}).show(a,s),this.labels.eq(0).trigger("mouseover").trigger("mouseenter").find("input").trigger("focus"),r.addClass("ui-state-active"),this._isOpen=!0,this._trigger("open")},close:function(){if(this._trigger("beforeclose")===!1)return;var t=this.options,n=t.hide,r=this.speed;e.isArray(t.hide)&&(n=t.hide[0],r=t.hide[1]||this.speed),this.menu.hide(n,r),this.button.removeClass("ui-state-active").trigger("blur").trigger("mouseleave"),this._isOpen=!1,this._trigger("close")},enable:function(){this._toggleDisabled(!1)},disable:function(){this._toggleDisabled(!0)},checkAll:function(e){this._toggleChecked(!0),this._trigger("checkAll")},uncheckAll:function(){this._toggleChecked(!1),this._trigger("uncheckAll")},getChecked:function(){return this.menu.find("input").filter(":checked")},destroy:function(){return e.Widget.prototype.destroy.call(this),this.button.remove(),this.menu.remove(),this.element.show(),this},isOpen:function(){return this._isOpen},widget:function(){return this.menu},getButton:function(){return this.button},_setOption:function(t,n){var r=this.menu;switch(t){case"header":r.find("div.ui-multiselect-header")[n?"show":"hide"]();break;case"checkAllText":r.find("a.ui-multiselect-all span").eq(-1).text(n);break;case"uncheckAllText":r.find("a.ui-multiselect-none span").eq(-1).text(n);break;case"height":r.find("ul").last().height(parseInt(n,10));break;case"minWidth":this.options[t]=parseInt(n,10),this._setButtonWidth(),this._setMenuWidth();break;case"selectedText":case"selectedList":case"noneSelectedText":this.options[t]=n,this.update();break;case"classes":r.add(this.button).removeClass(this.options.classes).addClass(n);break;case"multiple":r.toggleClass("ui-multiselect-single",!n),this.options.multiple=n,this.element[0].multiple=n,this.refresh()}e.Widget.prototype._setOption.apply(this,arguments)}})})(jQuery)